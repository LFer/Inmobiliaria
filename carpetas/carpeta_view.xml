<?xml version="1.0" encoding="UTF-8"?>
<openerp>
<data>

    <record id="view_carpeta_form" model="ir.ui.view">
        <field name="name">carpeta.form</field>
        <field name="model">carpeta</field>
        <field eval="1" name="priority"/>
        <field name="arch" type="xml">
            <form string="Carpeta" version="7.0">    
            <header>
            	<button name="action_estado_abierto" type="object" states="abierto,cerrado,pausado" string="Abierto" confirm="¿Confirma marcar como abierto?" class="oe_highlight"/>
            	<button name="action_estado_cerrado" type="object" states="abierto,cerrado,pausado" string="Cerrado" confirm="¿Confirma marcar como cerrado?" class="oe_highlight"/>
                <button name="action_estado_pausado" type="object" states="abierto,cerrado,pausado" string="Pausado" confirm="¿Confirma marcar para pausado?" class="oe_highlight"/>
                <button name="action_expediente_sent" type="object" string="Enviar por Email" class="oe_highlight" />
                <field name="state" widget="statusbar" statusbar_visible="abierto,cerrado,pausado" statusbar_colors='{"cerrado":"blue"}'/>
            </header>             
            <sheet>
                <group>                    
                    <field name="number" placeholder="Código referencia" style="width: 60%%"/>
                    <field name="name" placeholder="Descripción dela carpeta" style="width: 60%%"/>
                </group>
                <group col="4" colspan="2">
                    <field name="fechaalta" placeholder="Fecha de apertura" style="width: 60%%"/>
                    <field name="fechacierre" placeholder="Fecha de cierre" style="width: 60%%"/>
                </group>
                <group col="4" colspan="2">
                    <field name="tipocarpeta" style="width: 60%%"/>
                    <field name="tipoasunto" style="width: 60%%"/>                    
                </group>                
                <group cols="4">
                    <field name="refpropia" placeholder="Ubicación de la carpeta" style="width: 60%%"/>
                </group>                
                <field name="active" invisible="1"/>                                                
                <notebook colspan="4">
                    <page string="Participantes">
                        <!--<field name="participantes_ids" colspan="4" nolabel="1" mode="tree" context="{'default_model_name':'carpetas'}"  domain="[('model_name','=','carpetas')]">-->
                        <field name="participantes_ids" colspan="4" nolabel="1" mode="tree" context="{'default_tipo': 1}"  domain="[('tipo','=',1)]">
                            <tree string="Participantes"  editable="bottom">
                                <field name="partner_id"/>
                                <field name="tipo" invisible="True"/>
                                <field name="categoria" context="{'default_tipo': 1}"/>
                                <!--<field name="categoria"/>-->
                            </tree>
                        </field>
                    </page>
                    <page string="Actuaciones" >
                        <field name="accion_ids">
                            <tree string="Acciones">
                                <field name="name" />
                                <field name="date" />
                                <field name="duration" />
                                <field name="state" invisible="True" />
                            </tree>
                        </field>
                    </page>
                    <page string="Emails" >
                        <field name="emails" readonly="1" >
                            <form string="EMail" version="7.0">
                                <group>
                                    <field name="date" />                         
                                    <field name="author_id" />
                                    <label for="partner_ids" string="Destinatarios"/>
                                    <div groups="base.group_user">
                                        <field name="partner_ids" widget="many2many_tags_email" />
                                    </div>
                                    <field name="subject" placeholder="Subject..."/>
                                </group>
                                <field name="body" style="border: 1pt solid #cccccc;" />
                            </form>
                            <tree string="EMails" create="false" delete="false">
                                <field name="author_id" />
                                <field name="partner_ids" />  
                                <field name="subject" />             
                                <field name="date" />                         
                            </tree>
                        </field>
                    </page>
                    <page string="Carpetas Relacionados" >
                        <field name="carpetas_ids">
                            <tree string="Carpetas">
                                <field name="number" />
                                <field name="name" />                              
                            </tree>
                        </field>
                    </page>        
                    <page string="Gastos" >
                        <button name="action_nueva_factura" type="object" string="Facturar" confirm="¿Confirma facturar el concepto?" class="oe_highlight"/>
                        <field mode="tree" name="concepto_ids"  nolabel="1">
                            <tree string="Conceptos">                                
                                <field name="fecha"/>
                                <field name="name"/>
                                <field name="cantidad"/>
                                <field name="preciounidad"/> 
                                <field name="total"/>
                                <field name="facturar"/>
                                <field name="facturado"/>
                            </tree>                            
                        </field>
                        <group>
                            <field name="totalgral"/>                       
                            <field name="totalfacturado"/>
                            <field name="totalsinfacturar"/>
                        </group>
                    </page>
                    <page string="Facturas" >
                        <field name="facturas_ids" widget="one2many_list">
                            <tree string="Facturas" create="0">
                                <field name="date_invoice" />  
                                <field name="partner_id" />  
                                <field name="origin" />
                                <field name="state" invisible="True" />                                 
                            </tree>
                        </field>
                    </page>
                    <page string="Documentos Adjuntos" >
                        <field name="attachments" colspan="4" nolabel="1" mode="tree" >

                            <form string="Archivo" version="7.0">
                                <field name="datas" widget='image' nolabel="1" class="oe_avatar" options='{"preview_image": "datas", "size": [820, 360]}'/>
                                <group col="8">
                                    <group col="4">
                                        <field name="name" string="Nombre del documento adjunto" />
                                        <field name="tipodocumento" />
                                    </group>			                
                            
                                </group>
                            </form>
                            <tree string="Archivos" toolbar="0" delete="0" create="0">
                                <field name="name" attrs="{'readonly': True}" />
                                <field name="tipodocumento" />
                            </tree>
                        </field>
                    </page>
	                <page string="Histórico">
                        <group col="4" colspan="2">
                            <field name="create_date" style="width: 60%%"/>
                            <field name="write_date" style="width: 60%%"/>
                        </group>
                        <group col="4" colspan="2">
                            <field name="create_uid" style="width: 60%%"/>
                            <field name="write_uid" style="width: 60%%"/>                
                        </group>                    
	                    <field name="message_ids" colspan="4" nolabel="1" mode="tree" readonly="1">
	                        <tree string="Historia">
	                            <field name="display_text" string="Información Histórica"/>
	                            <field name="email_from" invisible="1"/>
	                        </tree>
	                    </field>
	                </page>
                 
                    <page string="Observaciones" >
                        <group colspan="4" col="1">
                            <separator string="Notas ingresadas" />
                            <field name="notas_ids" nolabel="1" >
                                <tree string="" delete="0">
                                    <field name="texto" string="Texto de la nota"/>
                                    <field name="fecha" string="Fecha"/>
                                    <field name="user_id" string="Usuario"/>
                                </tree>
                            </field>
                        </group>
                     </page>   
                    
                </notebook>
            </sheet>

            </form>
        </field>
    </record>

    <!-- fichero Kanban View -->
    <record model="ir.ui.view" id="carpeta_kanban_view">
        <field name="name">carpeta.kanban</field>
        <field name="model">carpeta</field>
        <field name="arch" type="xml">
            <kanban>
                <field name="name"/>
				<templates>
					<t t-name="kanban-box">
						<div class="oe_kanban_details">
                            <h4 class="oe_partner_heading"><a type="open">(<field name="number"/>)<field name="name"/></a></h4>
                            <div class="oe_kanban_partner_categories"/>
                            <div class="oe_kanban_partner_links"/>
                            <ul>
                                <li ><field name="tipoasunto"/></li>
                             </ul>    
                        </div>
					</t>						
				</templates>
            </kanban>
        </field>
    </record>

    <record id="view_carpeta_filter" model="ir.ui.view">
         <field name="name">carpeta.select</field>
         <field name="model">carpeta</field>
         <field name="arch" type="xml">
             <search string="Search Carpeta">
             	<field name="number" filter_domain="[('number','ilike',self)]"/>
                <field name="name" filter_domain="[('name','ilike',self)]"/>
                <field name="state" string="Estado" filter_domain="[('state','ilike', self)]"/>
                <separator/>
                <group expand="0" string="Agrupar por...">
                    <filter string="Nombre" context="{'group_by': 'name'}"/>
                    <filter string="Referencia" context="{'group_by': 'number'}"/>
                    <filter string="Fecha" context="{'group_by': 'fechaalta'}"/>
                    <filter string="Estado" context="{'group_by': 'state'}"/>
                </group>
            </search>
         </field>
     </record>


    <record id="view_carpeta_tree" model="ir.ui.view">
        <field name="name">carpeta.tree</field>
        <field name="model">carpeta</field>
        <field eval="1" name="priority"/>
        <field name="type">tree</field>
        <field name="arch" type="xml">            
            <tree string="Carpetas">
            <!--<tree string="Expedientes" colors="blue:number=='6666'">-->
            	<field name="number" />
                <field name="name" />
                <field name="tipoasunto" />
			</tree>
        </field>
    </record>

        
    <record id="action_carpeta_form" model="ir.actions.act_window">
        <field name="name">Carpetas</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">carpeta</field>
        <field name="view_type">form</field>
        <field name="view_mode">kanban,tree,form</field>
        <field name="search_view_id" ref="view_carpeta_filter"/>
        <field name="filter" eval="True"/>
    </record>
	
    <record id="action_carpeta_form_view1" model="ir.actions.act_window.view">
        <field eval="0" name="sequence"/>
        <field name="view_mode">kanban</field>
        <field name="view_id" ref="carpeta_kanban_view"/>
        <field name="act_window_id" ref="action_carpeta_form"/>
    </record>
    <record id="action_carpeta_form_view2" model="ir.actions.act_window.view">
        <field eval="2" name="sequence"/>
        <field name="view_mode">form</field>
        <field name="view_id" ref="view_carpeta_form"/>
        <field name="act_window_id" ref="action_carpeta_form"/>
    </record>
    <record id="action_carpeta_tree_view1" model="ir.actions.act_window.view">
        <field name="sequence" eval="1"/>
        <field name="view_mode">tree</field>
        <field name="view_id" ref="view_carpeta_tree"/>
        <field name="act_window_id" ref="action_carpeta_form"/>
    </record>
        

    <menuitem id="menu_partner_form" parent="base.menu_sales" action="action_carpeta_form" sequence="4"/>

     
        
</data>
</openerp>

    
